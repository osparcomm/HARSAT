<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>File management • harsat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="File management">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">harsat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.1006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/harsat.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Data file management</h6></li>
    <li><a class="dropdown-item" href="../articles/file-management.html">File locations</a></li>
    <li><a class="dropdown-item" href="../articles/reference-file-formats.html">Reference file formats</a></li>
    <li><a class="dropdown-item" href="../articles/external-file-format.html">External file format</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example_HELCOM.html">HELCOM (read first)</a></li>
    <li><a class="dropdown-item" href="../articles/example_OSPAR.html">OSPAR</a></li>
    <li><a class="dropdown-item" href="../articles/example_external_data.html">AMAP external data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Additional resources</h6></li>
    <li><a class="dropdown-item" href="../articles/datasets.html">Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/report-template.html">Report template</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/osparcomm/HARSAT/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>File management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/osparcomm/HARSAT/blob/develop/vignettes/file-management.Rmd" class="external-link"><code>vignettes/file-management.Rmd</code></a></small>
      <div class="d-none name"><code>file-management.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The R package <code>harsat</code> is designed to make it easy for you
to work with your own files. <code>harsat</code> uses the following
different kinds of file:</p>
<ul>
<li><p><strong>Data files</strong>. These are stored in a data directory
anywhere on your file system. Your actual data (contaminant measurments
and station dictionary) will be in these files. They will be TAB files
if they were downloaded from the ICES webservice (i.e. in ICES format)
or CSV files if you have put them together yourself (in the simpler
external format).</p></li>
<li><p><strong>Analysis files</strong>. These drive your actual
analysis. Three files are particulary important: the determinand file,
the species file (if doing a biota assessment) and the threshold file.
You will normally keep these in an analysis directory somewhere in your
file system. These will be CSV files, but they will be smaller and won’t
change anywhere near as often as the data files.</p></li>
<li><p><strong>Configuration files</strong>. There are several
additional configuration files which provide information about, for
example, chemical methods or pivot values for sediment normalisation.
The <code>harsat</code> package provides default versions of these files
which will be fine for most assessments. However, you
<strong>may</strong> override the defaults by putting<br>
modified copies of the files in the analysis directory described above.
The configuration files are also CSV files.</p></li>
</ul>
<p>The <a href="datasets.html">Datasets</a> page provides zip files
of:</p>
<ul>
<li>data and assessment files for each vignette</li>
<li>analysis files for recent OSPAR, HELCOM and AMAP assessments</li>
<li>the default additional configuration files</li>
</ul>
<p>If you need to assemble a reliable set of files for an assessment,
you should have both a data directory and an analysis directory. To
support full reproducibility, it would be good practice to also put a
copy of the all the configuration files (whether modified or not) in the
analysis directory. This is because updates to the R <code>harsat</code>
package <em>may</em> change the contents of the default configuration
files. Your own data files and analysis files, and any copied or
modified configuration files you have put into your analysis directory,
will not be affected.</p>
</div>
<div class="section level2">
<h2 id="file-encodings">File encodings<a class="anchor" aria-label="anchor" href="#file-encodings"></a>
</h2>
<p><code>harsat</code> currently expects all files to be encoded using
UTF-8. Standard ASCII files are also fine, as UTF-8 is a superset of
ASCII. If you are using accented characters in another encoding, such as
the common Latin-1 (also known as iso-8859-1) then we would ask you to
convert them to UTF-8 first. If you are using Microsoft Excel to prepare
them, this simply means saving them as CSV files with UTF-8
encoding.</p>
<blockquote>
<p>Note: the reason we do not allow people to choose a file encoding
option for input files, is that <code>harsat</code> reads quite a few
files, and it would be hard to specify encodings for all of them if they
different file encodings. UTF-8 is very standard now, it is
automatically used for ICES data anyway, so it <code>harsat</code> will
instead check for UTF-8, and if your files aren’t encoded as expected,
it will warn you.</p>
</blockquote>
<p>If you are using other tools, please check the documentation for
those tools to make sure that they aren’t converting files to Latin-1
behind your back.</p>
<p>To check the encoding of a file, use the <code>file</code> command,
which is slightly different depending on your operating system.</p>
<p>On a Mac:</p>
<pre><code>$ file -I file.csv
file.csv: text/csv; charset=utf-8</code></pre>
<p>On Windows or Linux (on Windows, you may need <a href="https://gnuwin32.sourceforge.net/packages/file.htm" class="external-link">File for
Windows</a>):</p>
<pre><code>$ file file.csv
file.csv: text/csv; charset=utf-8</code></pre>
<p>If the <code>charset</code> is not reported as <code>utf-8</code> (or
<code>us-ascii</code>), you will need to convert it. The easiest way to
do this is using <code>iconv</code>, which is built in on Macs, and
available as a <a href="https://gnuwin32.sourceforge.net/packages/libiconv.htm" class="external-link">download
on Windows</a>.</p>
<pre><code>iconv -f &lt;old charset&gt; -t utf-8 file.csv &gt; file-utf8.csv</code></pre>
<p>You can then use the converted version <code>file-utf8.csv</code> in
your workflows.</p>
</div>
<div class="section level2">
<h2 id="typical-workflow">Typical workflow<a class="anchor" aria-label="anchor" href="#typical-workflow"></a>
</h2>
<p>Let’s imagine you want to run an analysis with <code>harsat</code>,
and have already installed the R package (as described in the <a href="harsat.html">Getting started page</a>).</p>
<p>Now you need some data. Typically you would get this from the ICES
webservice, or put together your own data files using the simpler
external format.<br>
But for now let’s imagine you want to try out the OSPAR vignette. So you
can navigate to our <a href="datasets.html">Datasets</a> page, and look
for an approprate zip file to download for the OSPAR vignette.</p>
<p>If you download and unzip this file (you can unzip it anywhere you
like, but let’s pretend we’re using Windows and we unzip it at:
<code>C:\Users\stuart\OSPAR_vignette</code>) you’ll see that your disk
contains files as follows:</p>
<pre><code>+ C:\Users\stuart\OSPAR_vignette
  |
  + data
  | |
  | + test_data.csv
  | + station_dictionary.csv
  | + quality_assurance.csv
  |
  + analysis 
    |
    + determinand.csv
    + species.csv
    + thresholds_biota.csv</code></pre>
<p>This means that your directories are as follows:</p>
<ul>
<li>
<strong>Data directory</strong>:
<code>C:\Users\stuart\OSPAR_vignette\data</code>
</li>
<li>
<strong>Analysis directory</strong>:
<code>C:\Users\stuart\OSPAR_vignette\analysis</code>
</li>
</ul>
<p>Obviously, you can put these directories anywhere you like on your
file system. You can even put them on a removable disk if you like, or a
network shared drive. You can also call your directories something else.
For example, you might call them <code>data_vignette</code> and
<code>analysis_vignette</code> to distinguish them from other
assessments.</p>
<p>So, now let’s see how you might use these to run an analysis.</p>
</div>
<div class="section level2">
<h2 id="reading-your-data-files">Reading your data files<a class="anchor" aria-label="anchor" href="#reading-your-data-files"></a>
</h2>
<p>Virtually all the work you need to do involves the call to
<code>harsat</code>’s <code><a href="../reference/read_data.html">read_data()</a></code> function. Let’s suppose
your R working directory (or R Project) is
<code>C:\Users\stuart\OSPAR_vignette\</code>. Your call will then
typically look like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"biota"</span>, </span>
<span>  purpose <span class="op">=</span> <span class="st">"OSPAR"</span>,                               </span>
<span>  contaminants <span class="op">=</span> <span class="st">"test_data.csv"</span>, </span>
<span>  stations <span class="op">=</span> <span class="st">"station_dictionary.csv"</span>, </span>
<span>  data_format <span class="op">=</span> <span class="st">"ICES"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>By default, the function looks for your data and analysis files in
the directories called <code>data</code> and <code>assessment</code>
that are nested inside your working directory. If you have called them
something else, then you can use the <code>data_dir</code> and
<code>analysis_dir</code> arguments. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"biota"</span>, </span>
<span>  purpose <span class="op">=</span> <span class="st">"OSPAR"</span>,                               </span>
<span>  contaminants <span class="op">=</span> <span class="st">"test_data.csv"</span>, </span>
<span>  stations <span class="op">=</span> <span class="st">"station_dictionary.csv"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="st">"data_vignette"</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"ICES"</span>,</span>
<span>  analysis_dir <span class="op">=</span> <span class="st">"analysis_vignette"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can also specify absolute path names</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"biota"</span>, </span>
<span>  purpose <span class="op">=</span> <span class="st">"OSPAR"</span>,                               </span>
<span>  contaminants <span class="op">=</span> <span class="st">"test_data.csv"</span>, </span>
<span>  stations <span class="op">=</span> <span class="st">"station_dictionary.csv"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:"</span>, <span class="st">"Users"</span>, <span class="st">"stuart"</span>, <span class="st">"OSPAR_vignette"</span>, <span class="st">"data"</span><span class="op">)</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"ICES"</span>,</span>
<span>  analysis_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:"</span>, <span class="st">"Users"</span>, <span class="st">"stuart"</span>, <span class="st">"somewhere_else"</span>, <span class="st">"assessment"</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>There are a few important things to see here:</p>
<ol style="list-style-type: decimal">
<li><p>Note the use of <code><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path()</a></code> here to make portable
pathnames. Of course, each user can use whatever filename pattern works
best for them.</p></li>
<li><p>The <code>info_path</code> parameter can be a <em>vector</em> as
well as a single string. <code>harsat</code> will actually search
through every directory in this vector, looking for files like
<code>determinand.csv</code>. If the file is found in your local
analysis directory, it gets read and used. If not, we may try any other
directories in this vector. If we get to the end and we’ve still not
found a particular file (especially for common standard ones like
<code>matrix.csv</code> which translates common codes) then
<code>harsat</code>’s built-in directory of <strong>configuration
files</strong> gets used as a last resort. If a file is really essential
and we still can’t find it, then <code>harsat</code> will immediately
throw an error so you can intervene.</p></li>
</ol>
<p>When <code>harsat</code> does all this, it will log the file it
actually used, <em>and also</em> log a “thumbprint” of the file contents
– typically something like a string of hexadecimal digits. This will be
the same wherever the file comes from, so long as the contents of the
file are the same. If you move a file into a different directory but
don’t edit it, the same thumbprint will show. So, the thumbprints are a
vital tool in tracking reproducibility, as they change when the contents
of the data changes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arctic Monitoring and Assessment Programme (AMAP), Helsinki Commission (HELCOM), OSPAR Commission (OSPAR), International Council for the Exploration of the Sea (ICES), AmbieSense Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p><a href="https://creativecommons.org/licenses/by/4.0/" class="external-link"><img class="cc-badge" src="http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png"></a></p>
</div>

    </footer>
</div>





  </body>
</html>
