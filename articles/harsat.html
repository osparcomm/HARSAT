<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started • harsat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Getting started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">harsat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/harsat.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Data file management</h6></li>
    <li><a class="dropdown-item" href="../articles/file-management.html">File locations</a></li>
    <li><a class="dropdown-item" href="../articles/reference-file-formats.html">Reference file formats</a></li>
    <li><a class="dropdown-item" href="../articles/external-file-format.html">External file format</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example_HELCOM.html">HELCOM (read first)</a></li>
    <li><a class="dropdown-item" href="../articles/example_OSPAR.html">OSPAR</a></li>
    <li><a class="dropdown-item" href="../articles/example_external_data.html">AMAP external data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Additional resources</h6></li>
    <li><a class="dropdown-item" href="../articles/datasets.html">Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/report-template.html">Report template</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/osparcomm/HARSAT/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/osparcomm/HARSAT/blob/1.0.2/vignettes/harsat.Rmd" class="external-link"><code>vignettes/harsat.Rmd</code></a></small>
      <div class="d-none name"><code>harsat.Rmd</code></div>
    </div>

    
    
<p>For now, we will assume that you are familiar with running basic R
scripts and so on. We will focus on what the structure of a typical what
the code looks like in a typical analysis.</p>
<div class="section level2">
<h2 id="installing-harsat-from-a-bundled-package">Installing <code>harsat</code> from a bundled package<a class="anchor" aria-label="anchor" href="#installing-harsat-from-a-bundled-package"></a>
</h2>
<p>If you have a downloaded copy of the bundled package, whch will be a
file named something like <code>harsat_0.1.2.tar.gz</code> or
<code>harsat_0.1.2.tar</code>, you can install that directly, and R will
still take care of making sure you have all the right dependencies.</p>
<div class="section level3">
<h3 id="in-rstudio">In RStudio<a class="anchor" aria-label="anchor" href="#in-rstudio"></a>
</h3>
<p>From the <code>Packages</code> tab, choose <code>Install</code>, make
sure you have selected to install from a Package Archive File, then
press the <code>Browse...</code> button and locate your bundled package
file. Then finally press the <code>Install</code> button.</p>
</div>
<div class="section level3">
<h3 id="from-the-r-command-line">From the R command line<a class="anchor" aria-label="anchor" href="#from-the-r-command-line"></a>
</h3>
<p>Use a command:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(remotes) <span class="sc">--</span> <span class="cf">if</span> needed</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(remotes)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_local</span>(<span class="st">"~/Downloads/harsat_0.1.2.tar"</span>)</span></code></pre></div>
<p>Use the right file for the downloaded package file, press enter, and
away you go.</p>
</div>
</div>
<div class="section level2">
<h2 id="installing-harsat-directly-from-github">Installing <code>harsat</code> directly from GitHub<a class="anchor" aria-label="anchor" href="#installing-harsat-directly-from-github"></a>
</h2>
<p>To install the latest version, use the <code>remotes</code>
package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages(remotes) -- if needed</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"osparcomm/harsat@main"</span><span class="op">)</span> </span></code></pre></div>
<p>The development version is similar:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"osparcomm/HARSAT@develop"</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note: many of the functions currently have a <code>cstm</code>
prefix. When the code was originally developed, we thought of it as
“contaminant time series modelling”, which is why you get all these
<code>cstm</code> prefixes. These will be removed in the near
future.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="loading-the-code">Loading the code<a class="anchor" aria-label="anchor" href="#loading-the-code"></a>
</h2>
<p>Now, within R, you can load the library in the usual way</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/osparcomm/HARSAT" class="external-link">harsat</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-files">Accessing files<a class="anchor" aria-label="anchor" href="#accessing-files"></a>
</h2>
<p>How you organize your files is up to you. We set up our main
directory to find the data files. If you use your own data files, you
will need to point to a directory containing a copy. We usually do this
by putting our data files in a directory <code>data</code>, and
information files in a directory <code>information</code>, but you can
use any directory for these.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">working.directory</span> <span class="op">&lt;-</span> <span class="st">'C:/Users/robfr/Documents/HARSAT/HARSAT'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-in-the-data">Reading in the data<a class="anchor" aria-label="anchor" href="#reading-in-the-data"></a>
</h2>
<p>The first step is to read in the data that we’ve got, using
<code><a href="../reference/read_data.html">read_data()</a></code>. We will go through some of these
arguments.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"water"</span>,</span>
<span>  purpose <span class="op">=</span> <span class="st">"OSPAR"</span>,</span>
<span>  contaminants <span class="op">=</span> <span class="st">"water.txt"</span>,</span>
<span>  stations <span class="op">=</span> <span class="st">"stations.txt"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"data"</span>, <span class="st">"example_OSPAR"</span><span class="op">)</span>,</span>
<span>  info_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"information"</span>, <span class="st">"OSPAR_2022"</span><span class="op">)</span>,</span>
<span>  extraction <span class="op">=</span> <span class="st">"2023/08/23"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Found in path determinand.csv C:\Users\robfr\Documents\HARSAT\HARSAT\information\OSPAR_2022\determinand.csv </span></span>
<span><span class="co">#&gt; Found in path species.csv C:\Users\robfr\Documents\HARSAT\HARSAT\information\OSPAR_2022\species.csv </span></span>
<span><span class="co">#&gt; Found in path thresholds_water.csv C:\Users\robfr\Documents\HARSAT\HARSAT\information\OSPAR_2022\thresholds_water.csv </span></span>
<span><span class="co">#&gt; Found in package method_extraction.csv C:/Users/robfr/Documents/HARSAT/HARSAT/inst/information/method_extraction.csv </span></span>
<span><span class="co">#&gt; Found in package pivot_values.csv C:/Users/robfr/Documents/HARSAT/HARSAT/inst/information/pivot_values.csv </span></span>
<span><span class="co">#&gt; Found in package matrix.csv C:/Users/robfr/Documents/HARSAT/HARSAT/inst/information/matrix.csv </span></span>
<span><span class="co">#&gt; Found in package imposex.csv C:/Users/robfr/Documents/HARSAT/HARSAT/inst/information/imposex.csv </span></span>
<span><span class="co">#&gt; MD5 digest for: 'C:\Users\robfr\Documents\HARSAT\HARSAT\information\OSPAR_2022\determinand.csv': '6b36346446c0ac04a52b3f1347829f6b'</span></span>
<span><span class="co">#&gt; MD5 digest for: 'C:/Users/robfr/Documents/HARSAT/HARSAT/inst/information/matrix.csv': '4b4fb3814bb84cfbf9b37f7b59d45eb9'</span></span>
<span><span class="co">#&gt; MD5 digest for: 'C:\Users\robfr\Documents\HARSAT\HARSAT\information\OSPAR_2022\thresholds_water.csv': '615ef96f716ef1d43c01ab67f383c881'</span></span>
<span><span class="co">#&gt; Reading station dictionary from:</span></span>
<span><span class="co">#&gt;  'C:/Users/robfr/Documents/HARSAT/HARSAT/data/example_OSPAR/stations.txt'</span></span>
<span><span class="co">#&gt; MD5 digest for: 'C:/Users/robfr/Documents/HARSAT/HARSAT/data/example_OSPAR/stations.txt': '58b9e90f314e89f637c60558c06755f4'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reading contaminant and effects data from:</span></span>
<span><span class="co">#&gt;  'C:/Users/robfr/Documents/HARSAT/HARSAT/data/example_OSPAR/water.txt'</span></span>
<span><span class="co">#&gt; MD5 digest for: 'C:/Users/robfr/Documents/HARSAT/HARSAT/data/example_OSPAR/water.txt': '13d63b6161b671165b215b58f5e22469'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matching data with station dictionary</span></span>
<span><span class="co">#&gt;  - restricting to stations in these convention areas: OSPAR </span></span>
<span><span class="co">#&gt;  - restricting to station with data types CW or EW </span></span>
<span><span class="co">#&gt;  - restricting to stations marked for temporal monitoring</span></span>
<span><span class="co">#&gt;  - restricting to data with program governance: OSPAR, AMAP </span></span>
<span><span class="co">#&gt;  - restricting to stations with program governance: OSPAR, AMAP </span></span>
<span><span class="co">#&gt;  - matching 2768 records by coordinates</span></span>
<span><span class="co">#&gt;  - matching 1583 records by station name</span></span>
<span><span class="co">#&gt;  - grouping stations using station_asmtmimegovernance</span></span>
<span><span class="co">#&gt;  - 4251 of 4351 records have been matched to a station</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Argument max_year taken to be the maximum year in the data: 2022</span></span></code></pre></div>
<p>The main arguments here are as follows:</p>
<ul>
<li>
<code>compartment</code> is an argument which specifies whether
we’re dealing with a biota assessment, a sediment assessment, or a water
assessment.</li>
<li>
<code>purpose</code> means we can mirror an <code>OSPAR</code> style
assessment, a <code>HELCOM</code> style assessment, an
<code>AMAP</code>-style assessment, or <code>other</code> which means
you can basically tailor it yourself and the idea is that the code will
be sufficiently flexible that you can do a lot of tailoring to suit your
own needs.</li>
<li>
<code>contaminants</code> is a data file which has all the chemical
measurements in it.</li>
<li>
<code>stations</code> is the station file which is directly related
to the station dictionary that we get out at from ICES.</li>
<li>
<code>info_dir</code> is your directory for reference tables – we
will come back to that.</li>
</ul>
<p>This reads in the three data sets, but does no more than that at this
stage.</p>
<p>Once you get to this point, you can look at the data if you want to,
or do anything else that you need with the data before proceeding.
Essentially the files that come in at this point are unchanged from the
files that we are reading them in from. This is basically just reading
in the data and setting things up.</p>
<p>At this point we might want to do a whole lot of <em>ad hoc</em>
corrections to these data, as is done with the OSPAR estimates.</p>
</div>
<div class="section level2">
<h2 id="tidying-the-data">Tidying the data<a class="anchor" aria-label="anchor" href="#tidying-the-data"></a>
</h2>
<p>The next step is to clean the data to prepare for analysis, using
<code><a href="../reference/tidy_data.html">tidy_data()</a></code>. This step tidies up the data structures that
we’ve got there. It does filtering so that we get data in the form that
we want for say, an OSPAR assessment or a HELCOM assessment. It also
streamlines some of the data files.</p>
<p>This may generate warnings. For example, when we’re cleaning the
station dictionary, we’ve may find some issues with duplicate stations.
Similarly, when it comes to cleaning the contaminant and biological
effects data, we’ve may find some data from stations which are
unrecognized by the station dictionary. Sometimes that’s fine and
sometimes that’s not. Warnings are supported by output files which allow
you to come in and have a look and see which values are affected, so you
can go and check them out in more detail.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_data.html">tidy_data</a></span><span class="op">(</span><span class="va">water_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/water' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/water_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dropping 411 records from data flagged for deletion. Possible reasons are:</span></span>
<span><span class="co">#&gt;  - vflag = suspect</span></span>
<span><span class="co">#&gt;  - upper depth &gt;5.5m</span></span>
<span><span class="co">#&gt;  - filtration missing</span></span>
<span><span class="co">#&gt;  - matrix = 'SPM'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dropping 94 records from data that have no valid station code</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dropping 13633 stations that are not associated with any data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning station dictionary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning contaminant and biological effects data</span></span></code></pre></div>
<p>To this point, we’ve still not done anything with the datasets.</p>
</div>
<div class="section level2">
<h2 id="create-a-time-series">Create a time series<a class="anchor" aria-label="anchor" href="#create-a-time-series"></a>
</h2>
<p>Now we can group the data into time series, using
<code><a href="../reference/create_timeseries.html">create_timeseries()</a></code>. This means identifying which data
points belong to the same time series, and then set it up as a structure
which then allows us to do the assessments.</p>
<p>There are various different ways in which we can specify which
determinants we actually want to assess. In this case, the
<code>determinands</code> parameter specifies CHR, BBKF, PFOS, CB138,
HCEPX, and HCH. There are various other arguments which allow you to
control just how the data are manipulated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_timeseries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_timeseries.html">create_timeseries</a></span><span class="op">(</span></span>
<span>  <span class="va">water_data</span>,</span>
<span>  determinands.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    CHR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"CHRTR"</span>, action <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span>,</span>
<span>    BBKF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BBF"</span>, <span class="st">"BKF"</span>, <span class="st">"BBJF"</span>, <span class="st">"BBJKF"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"bespoke"</span><span class="op">)</span>,</span>
<span>    PFOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N-PFOS"</span>, <span class="st">"BR-PFOS"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span>,</span>
<span>    CB138 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CB138+163"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span>,</span>
<span>    HCEPX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HCEPC"</span>, <span class="st">"HCEPT"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span>, </span>
<span>    HCH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HCHA"</span>, <span class="st">"HCHB"</span>, <span class="st">"HCHG"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/water' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/water_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning data</span></span>
<span><span class="co">#&gt;    Dropping stations with no data between 2017 and 2022</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'basis': see basis_queries.csv</span></span>
<span><span class="co">#&gt;    Replicate measurements, only first retained: see replicate_measurements.csv</span></span>
<span><span class="co">#&gt;    Non-positive detection limits: see non_positive_det_limits.csv</span></span>
<span><span class="co">#&gt;    Limit of quantification less than limit of detection: see limits_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Censoring codes D and Q inconsistent with respective limits: see censoring_codes_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Detection limit higher than data: see detection_limit_high.csv</span></span>
<span><span class="co">#&gt;    Implausible uncertainties reported with data: see implausible_uncertainties_reported.csv</span></span>
<span><span class="co">#&gt;    Data submitted as CHRTR relabelled as CHR </span></span>
<span><span class="co">#&gt;    Data submitted as BBF, BKF summed to give BBKF</span></span>
<span><span class="co">#&gt;      1 of 71 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt;    Data submitted as BBJF, BKF summed to give BBJKF</span></span>
<span><span class="co">#&gt;      99 of 99 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt;    Data submitted as HCEPC, HCEPT summed to give HCEPX</span></span>
<span><span class="co">#&gt;    Data submitted as HCHA, HCHB, HCHG summed to give HCH</span></span>
<span><span class="co">#&gt;      190 of 234 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Creating time series data</span></span>
<span><span class="co">#&gt;    Converting data to appropriate basis for statistical analysis</span></span>
<span><span class="co">#&gt;    Dropping groups of compounds / stations with no data between 2017 and 2022</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assessment">Assessment<a class="anchor" aria-label="anchor" href="#assessment"></a>
</h2>
<p>The next the next stage is to do the assessment, using
<code><a href="../reference/run_assessment.html">run_assessment()</a></code>.</p>
<p>We’ve created a time series object, and pass that into this call. We
have to say which thresholds we’re going to use when we do the
assessment and there are other options which we can put in here. But
this will just run. You can see that it tells you which time series
we’re actually assessing as it progresses. This gives you an idea of how
how many cups of tea you can drink before it’s all finished.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_assessment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_assessment.html">run_assessment</a></span><span class="op">(</span></span>
<span>  <span class="va">water_timeseries</span>, </span>
<span>  AC <span class="op">=</span> <span class="st">"EQS"</span>, </span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Setting up clusters: be patient, it can take a while!</span></span></code></pre></div>
<p>There are various little warnings: these ones are nothing to worry
about.</p>
<p>We can then check that everything is converged, using
<code><a href="../reference/check_assessment.html">check_assessment()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_assessment.html">check_assessment</a></span><span class="op">(</span><span class="va">water_assessment</span><span class="op">)</span></span>
<span><span class="co">#&gt; All assessment models have converged</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reporting">Reporting<a class="anchor" aria-label="anchor" href="#reporting"></a>
</h2>
<p>We can then get a summary table of our results. We want a directory
where we can put it. And <code>harsat</code> won’t create a directory if
there’s nothing there, so let’s make a new directory,
<code>./output/tutorial</code>, and put the full path into
<code>summary.dir</code>, so we can tell <code>harsat</code> where to
write to.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"output"</span>, <span class="st">"tutorial"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">summary.dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">summary.dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And then we can generate the summary proper, using
<code><a href="../reference/write_summary_table.html">write_summary_table()</a></code>. The summary file which will be very
familiar to those who have been involved in the OSPAR and the HELCOM
assessments. The summary files have information about each time series,
what the time series represents (which is the first set of columns),
followed by statistical results, such as p values, and summary values
such as the number of years in the data set, when it starts and
finishes. And towards the end, we’ve got comparisons against various
different threshold values.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_summary_table.html">write_summary_table</a></span><span class="op">(</span></span>
<span>  <span class="va">water_assessment</span>,</span>
<span>  determinandGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Metals"</span>, <span class="st">"Organotins"</span>, <span class="st">"PAH_parent"</span>,  <span class="st">"Organofluorines"</span>, </span>
<span>      <span class="st">"Chlorobiphenyls"</span>, <span class="st">"Organochlorines"</span>, <span class="st">"Pesticides"</span></span>
<span>    <span class="op">)</span>,  </span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Metals"</span>, <span class="st">"Organotins"</span>, <span class="st">"PAH parent compounds"</span>, <span class="st">"Organofluorines"</span>, </span>
<span>      <span class="st">"Polychlorinated biphenyls"</span>, <span class="st">"Organochlorines (other)"</span>, <span class="st">"Pesticides"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  classColour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    below <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EQS"</span> <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span>, </span>
<span>    above <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EQS"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>, </span>
<span>    none <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  collapse_AC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>EAC <span class="op">=</span> <span class="st">"EQS"</span><span class="op">)</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="va">summary.dir</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in write_summary_table(water_assessment, determinandGroups = list(levels = c("Metals", : unused argument (classColour = list(below = c(EQS = "green"), above = c(EQS = "red"), none = "black"))</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arctic Monitoring and Assessment Programme (AMAP), Helsinki Commission (HELCOM), OSPAR Commission (OSPAR), International Council for the Exploration of the Sea (ICES), AmbieSense Ltd.</p>
</div>

<div class="pkgdown-footer-right">
  <p><a href="https://creativecommons.org/licenses/by/4.0/" class="external-link"><img class="cc-badge" src="http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by.png"></a></p>
</div>

    </footer>
</div>





  </body>
</html>
